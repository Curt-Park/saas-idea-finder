name: Daily SaaS Analysis

on:
  schedule:
    # Îß§Ïùº ÏûêÏ†ï (UTC)Ïóê Ïã§Ìñâ
    - cron: '0 0 * * *'
  workflow_dispatch: # ÏàòÎèô Ïã§ÌñâÎèÑ Í∞ÄÎä•

jobs:
  analyze:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout repository
      uses: actions/checkout@v4
      
    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.12'
        
    - name: Cache pip dependencies
      uses: actions/cache@v3
      with:
        path: ~/.cache/pip
        key: ${{ runner.os }}-pip-${{ hashFiles('**/requirements.txt') }}
        restore-keys: |
          ${{ runner.os }}-pip-
          
    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install -r requirements.txt
        
    - name: Run SaaS analysis
      env:
        OPENAI_API_KEY: ${{ secrets.OPENAI_API_KEY }}
        SERPER_API_KEY: ${{ secrets.SERPER_API_KEY }}
        REDDIT_CLIENT_ID: ${{ secrets.REDDIT_CLIENT_ID }}
        REDDIT_CLIENT_SECRET: ${{ secrets.REDDIT_CLIENT_SECRET }}
        REDDIT_USER_AGENT: ${{ secrets.REDDIT_USER_AGENT }}
      run: |
        python main.py --model gpt-4o-mini --temperature 0.3
        
    - name: Create reports directory
      run: mkdir -p reports
      
    - name: Copy latest report to reports directory
      run: |
        # ÏµúÏã† Î¶¨Ìè¨Ìä∏ ÌååÏùºÏùÑ Ï∞æÏïÑÏÑú Î≥µÏÇ¨
        LATEST_REPORT=$(ls -t report/*.md | head -n 1)
        if [ -n "$LATEST_REPORT" ]; then
          cp "$LATEST_REPORT" reports/latest-report.md
          echo "Report copied: $LATEST_REPORT"
        else
          echo "No report found"
          exit 1
        fi
        
    - name: Generate index page
      run: |
        cat > reports/index.html << 'EOF'
        <!DOCTYPE html>
        <html lang="en">
        <head>
            <meta charset="UTF-8">
            <meta name="viewport" content="width=device-width, initial-scale=1.0">
            <title>SaaS Idea Finder - Daily Reports</title>
            <style>
                body {
                    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
                    max-width: 1200px;
                    margin: 0 auto;
                    padding: 20px;
                    background-color: #f5f5f5;
                }
                .header {
                    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                    color: white;
                    padding: 40px;
                    border-radius: 10px;
                    text-align: center;
                    margin-bottom: 30px;
                }
                .header h1 {
                    margin: 0;
                    font-size: 2.5em;
                }
                .header p {
                    margin: 10px 0 0 0;
                    opacity: 0.9;
                }
                .report-card {
                    background: white;
                    border-radius: 10px;
                    padding: 30px;
                    margin-bottom: 20px;
                    box-shadow: 0 2px 10px rgba(0,0,0,0.1);
                }
                .report-card h2 {
                    color: #333;
                    margin-top: 0;
                }
                .report-card p {
                    color: #666;
                    line-height: 1.6;
                }
                .download-btn {
                    display: inline-block;
                    background: #667eea;
                    color: white;
                    padding: 12px 24px;
                    text-decoration: none;
                    border-radius: 5px;
                    margin-top: 15px;
                    transition: background 0.3s;
                }
                .download-btn:hover {
                    background: #5a6fd8;
                }
                .footer {
                    text-align: center;
                    color: #666;
                    margin-top: 40px;
                    padding: 20px;
                }
                .status {
                    display: inline-block;
                    padding: 4px 12px;
                    border-radius: 20px;
                    font-size: 0.9em;
                    font-weight: 500;
                }
                .status.success {
                    background: #d4edda;
                    color: #155724;
                }
            </style>
        </head>
        <body>
            <div class="header">
                <h1>üöÄ SaaS Idea Finder</h1>
                <p>Daily AI-powered SaaS opportunity analysis</p>
            </div>
            
            <div class="report-card">
                <h2>üìä Latest Analysis Report</h2>
                <p>Our AI agents have analyzed the latest Reddit trends, successful micro-SaaS projects, and market opportunities to provide you with actionable insights for your next SaaS venture.</p>
                <p><strong>Generated:</strong> <span id="generated-date">Loading...</span></p>
                <p><strong>Status:</strong> <span class="status success">‚úÖ Analysis Complete</span></p>
                <a href="latest-report.md" class="download-btn">üì• Download Latest Report</a>
            </div>
            
            <div class="report-card">
                <h2>üîç What's Included</h2>
                <ul>
                    <li><strong>Reddit Trend Analysis:</strong> Latest pain points and opportunities from Reddit communities</li>
                    <li><strong>Successful Project Research:</strong> Analysis of recent micro-SaaS successes</li>
                    <li><strong>Competitive Landscape:</strong> Strengths, weaknesses, and market gaps</li>
                    <li><strong>MVP Feature Suggestions:</strong> Core enhancements with rationale</li>
                    <li><strong>Implementation Challenges:</strong> Key problems and solutions</li>
                    <li><strong>Revenue Analysis:</strong> Market potential and financial viability</li>
                </ul>
            </div>
            
            <div class="footer">
                <p>ü§ñ Powered by AI Agents | Updated Daily at Midnight UTC</p>
                <p><a href="https://github.com/Curt-Park/saas-idea-finder">View Source Code</a></p>
            </div>
            
            <script>
                // Set the generated date
                document.getElementById('generated-date').textContent = new Date().toLocaleString();
            </script>
        </body>
        </html>
        EOF
        
    - name: Commit and push reports
      run: |
        git config --local user.email "action@github.com"
        git config --local user.name "GitHub Action"
        git add reports/
        git commit -m "Update daily analysis report - $(date)" || echo "No changes to commit"
        git push
